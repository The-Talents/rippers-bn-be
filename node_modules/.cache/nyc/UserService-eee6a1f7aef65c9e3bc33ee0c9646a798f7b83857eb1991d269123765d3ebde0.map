{"version":3,"names":["User","require","validateUserRegistration","encryptPassword","generateJwtToken","bcrypt","createUser","userData","hashedPassword","password","newUser","create","firstName","lastName","email","birthOfDate","preferredLanguage","preferredCurrency","whereYouLive","role","department","lineManager","gender","telephoneNumber","token","user","getUserByEmail","findOne","where","message","success","error","console","loginUser","userResponse","log","isPasswordValid","compare","module","exports"],"sourceRoot":"N:\\Personal Projects\\The Talent\\Barefoot-Nomand_v1\\rippers-bn-be\\src\\Services\\","sources":["UserService.js"],"sourcesContent":["const { User } = require('../../models');\r\nconst { validateUserRegistration, encryptPassword, generateJwtToken } = require('../validations/userValidation');\r\nconst bcrypt = require('bcryptjs');\r\n\r\nconst createUser = async (userData) => {\r\n  await validateUserRegistration(userData);\r\n  const hashedPassword = await encryptPassword(userData.password);\r\n\r\n  const newUser = await User.create({\r\n    firstName: userData.firstName,\r\n    lastName: userData.lastName,\r\n    email: userData.email,\r\n    birthOfDate: userData.birthOfDate,\r\n    preferredLanguage: userData.preferredLanguage,\r\n    preferredCurrency: userData.preferredCurrency,\r\n    whereYouLive: userData.whereYouLive,\r\n    role: userData.role,\r\n    department: userData.department,\r\n    lineManager: userData.lineManager,\r\n    gender: userData.gender,\r\n    telephoneNumber: userData.telephoneNumber,\r\n    password: hashedPassword\r\n  });\r\n\r\n  const token = generateJwtToken(newUser);\r\n  return { user: newUser, token };\r\n};\r\n\r\nconst getUserByEmail = async (email) => {\r\n  try {\r\n    const user = await User.findOne({ where: { email } });\r\n    if (!user) {\r\n      return { message: 'User not found', success: false };\r\n    }\r\n    return { user, success: true };\r\n  } catch (error) {\r\n    console.error('Error fetching user by email:', error);\r\n    return { message: 'An error occurred while fetching the user', success: false, error };\r\n  }\r\n};\r\n\r\n\r\nconst loginUser = async (email, password) => {\r\n  const userResponse = await getUserByEmail(email);\r\n\r\n  if (!userResponse.success) {\r\n    return userResponse; \r\n  }\r\n\r\n  const user = userResponse.user;\r\n\r\n  if (!user) {\r\n    return { success: false, message: 'Invalid credentials' };\r\n  }\r\n\r\n  console.log('User Data:', user); \r\n\r\n \r\n  const isPasswordValid = await bcrypt.compare(password, user.password);\r\n\r\n  if (!isPasswordValid) {\r\n    return { success: false, message: 'Invalid credentials' };\r\n  }\r\n\r\n  const token = generateJwtToken(user); \r\n  console.log('Generated Token:', token); \r\n  return { user, token };\r\n};\r\n\r\n\r\nmodule.exports = { createUser,loginUser };\r\n"],"mappings":"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","ignoreList":[]}