{"version":3,"names":["OAuth2Client","require","User","jwt","client","process","env","GOOGLE_CLIENT_ID","googleLogin","token","ticket","verifyIdToken","idToken","audience","payload","getPayload","email","user","findOne","where","error","Error","statusCode","authToken","sign","userId","id","role","JWT_SECRET","expiresIn","firstName","lastName","profilePicture","NODE_ENV","console","module","exports"],"sourceRoot":"D:\\rippers\\rippers-bn-be\\src\\Services\\","sources":["authService.js"],"sourcesContent":["const { OAuth2Client } = require('google-auth-library');\r\nconst { User } = require('../../models');\r\nconst jwt = require('jsonwebtoken');\r\n\r\nconst client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\r\n\r\nconst googleLogin = async (token) => {\r\n  try {\r\n    const ticket = await client.verifyIdToken({\r\n      idToken: token,\r\n      audience: process.env.GOOGLE_CLIENT_ID,\r\n    });\r\n\r\n    const payload = ticket.getPayload();\r\n    const email = payload.email;\r\n\r\n    const user = await User.findOne({ where: { email } });\r\n\r\n    if (!user) {\r\n      const error = new Error('Account does not exist. Please create an account first.');\r\n      error.statusCode = 404;\r\n      throw error;\r\n    }\r\n\r\n    const authToken = jwt.sign(\r\n      { userId: user.id, role: user.role },\r\n      process.env.JWT_SECRET,\r\n      { expiresIn: '1h' }\r\n    );\r\n\r\n    return {\r\n      userId: user.id,\r\n      firstName: user.firstName,\r\n      lastName: user.lastName,\r\n      email: user.email,\r\n      profilePicture: user.profilePicture,\r\n      token: authToken,\r\n    };\r\n  } catch (error) {\r\n    if (!error.statusCode) {\r\n      error.statusCode = 400;\r\n    }\r\n    // Only log in non-test environment\r\n    if (process.env.NODE_ENV !== 'test') {\r\n      console.error('Error in googleLogin:', error);\r\n    }\r\n    throw error;\r\n  }\r\n};\r\n\r\nmodule.exports = { googleLogin };"],"mappings":"AAAA,MAAM;EAAEA;AAAa,CAAC,GAAGC,OAAO,CAAC,qBAAqB,CAAC;AACvD,MAAM;EAAEC;AAAK,CAAC,GAAGD,OAAO,CAAC,cAAc,CAAC;AACxC,MAAME,GAAG,GAAGF,OAAO,CAAC,cAAc,CAAC;AAEnC,MAAMG,MAAM,GAAG,IAAIJ,YAAY,CAACK,OAAO,CAACC,GAAG,CAACC,gBAAgB,CAAC;AAE7D,MAAMC,WAAW,GAAG,MAAOC,KAAK,IAAK;EACnC,IAAI;IACF,MAAMC,MAAM,GAAG,MAAMN,MAAM,CAACO,aAAa,CAAC;MACxCC,OAAO,EAAEH,KAAK;MACdI,QAAQ,EAAER,OAAO,CAACC,GAAG,CAACC;IACxB,CAAC,CAAC;IAEF,MAAMO,OAAO,GAAGJ,MAAM,CAACK,UAAU,CAAC,CAAC;IACnC,MAAMC,KAAK,GAAGF,OAAO,CAACE,KAAK;IAE3B,MAAMC,IAAI,GAAG,MAAMf,IAAI,CAACgB,OAAO,CAAC;MAAEC,KAAK,EAAE;QAAEH;MAAM;IAAE,CAAC,CAAC;IAErD,IAAI,CAACC,IAAI,EAAE;MACT,MAAMG,KAAK,GAAG,IAAIC,KAAK,CAAC,yDAAyD,CAAC;MAClFD,KAAK,CAACE,UAAU,GAAG,GAAG;MACtB,MAAMF,KAAK;IACb;IAEA,MAAMG,SAAS,GAAGpB,GAAG,CAACqB,IAAI,CACxB;MAAEC,MAAM,EAAER,IAAI,CAACS,EAAE;MAAEC,IAAI,EAAEV,IAAI,CAACU;IAAK,CAAC,EACpCtB,OAAO,CAACC,GAAG,CAACsB,UAAU,EACtB;MAAEC,SAAS,EAAE;IAAK,CACpB,CAAC;IAED,OAAO;MACLJ,MAAM,EAAER,IAAI,CAACS,EAAE;MACfI,SAAS,EAAEb,IAAI,CAACa,SAAS;MACzBC,QAAQ,EAAEd,IAAI,CAACc,QAAQ;MACvBf,KAAK,EAAEC,IAAI,CAACD,KAAK;MACjBgB,cAAc,EAAEf,IAAI,CAACe,cAAc;MACnCvB,KAAK,EAAEc;IACT,CAAC;EACH,CAAC,CAAC,OAAOH,KAAK,EAAE;IACd,IAAI,CAACA,KAAK,CAACE,UAAU,EAAE;MACrBF,KAAK,CAACE,UAAU,GAAG,GAAG;IACxB;IACA;IACA,IAAIjB,OAAO,CAACC,GAAG,CAAC2B,QAAQ,KAAK,MAAM,EAAE;MACnCC,OAAO,CAACd,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;IAC/C;IACA,MAAMA,KAAK;EACb;AACF,CAAC;AAEDe,MAAM,CAACC,OAAO,GAAG;EAAE5B;AAAY,CAAC","ignoreList":[]}